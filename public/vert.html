<html>
  <head>
    <script src="/js/d3.min.js"></script>
    <style>
    rect {
      fill: steelblue;
    }
    .chart text {
      fill: white;
      font: 10px sans-serif;
      text-anchor: end;
    }
    </style>
  </head>
  <body>
    <div><svg class="chart"></svg></div>
    <script>
      var segments = 10
      //var data = new Array(segments).join('0').split('');
      var data = [];
      var w = 20, h = 100;
      var msgs = 0

      var stream = new EventSource('/tweet_stream');
      stream.addEventListener('message', function(event) {
        //if(queue.length > 10) queue.pop();
        msgs += 1;
        //queue.push(JSON.parse(event.data));
      }, false);
      

      stream.addEventListener('open', function(e) {
        console.log(e);
        // Connection was opened.
      }, false);

      stream.addEventListener('error', function(e) {
          console.log(e);
          if (e.readyState == EventSource.CLOSED) {
            // Connection was closed.
          }
      }, false);

      d3.select("body")
        .style("background-color", "orange");

      d3.select(".chart")
        .select("text")
          .append("text")
        .attr     
       

      function update() {
        console.log(msgs);
        if(data.length > segments) data.shift();
        data.push(msgs);
        msgs = 0;

        d3.select(".max").text = d3.max(data);
        var chart = d3.select(".chart")
            .attr("class", "chart")
            .attr("width", w * data.length)
            .attr("height", h);

        var x = d3.scale.linear()
            .domain([0, 1])
            .range([0, w]);
                     
        var y = d3.scale.linear()
            .domain([0, d3.max(data)])
            .range([0, h]); //rangeRound is used for antialiasing

        var rect = chart.selectAll("rect")
            .data(data)
            .attr("x", function(d, i) { return x(i) - .5; })
            .attr("y", function(d) { return h - y(d) - .5; })
            .attr("width", w)
            .attr("height", function(d) { return y(d); } );
            
        rect.enter().append("rect")
            .attr("x", function(d, i) { return x(i) - .5; })
            .attr("y", function(d) { return h })
          .transition()
            .attr("y", function(d) { return h - y(d) - .5; })
            .attr("width", w)
            .attr("height", function(d) { return y(d); } );

        rect.exit()
            .remove();

      }

      setInterval(function() {update();}, 500);
    </script>
  </body>
</html>
