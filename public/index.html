<html>
  <head>
  </head>
  <body>
    <div id="tweets" />
    <script>

var msgs = 0
var queue = [];

      function update() {
        var msg = queue.shift();
        var delay = 250;
        if(msg != null) {
          document.getElementById("tweets").innerHTML = "<img src='" + msg.message.user.profile_image_uri + "' height=100px/> " + msg.message.text;
          delay = 5000;
          console.log(" pop:" + queue.length);
        }else {
          delay = 5000;
          console.log("none: " + queue.length);
        }
      }

      var stream = new EventSource('/tweet_stream');
      stream.addEventListener('message', function(event) {
        //if(queue.length > 10) queue.pop();
        queue.push(JSON.parse(event.data));
      }, false);
      

      stream.addEventListener('open', function(e) {
          console.log(e);
          // Connection was opened.
      }, false);

      stream.addEventListener('error', function(e) {
          console.log(e);
          if (e.readyState == EventSource.CLOSED) {
                // Connection was closed.
                  }
      }, false);
      update();
      window.setInterval(function() {update()}, 3000);
    </script>
  </body>
</html>
