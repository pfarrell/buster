<html>
  <head>
    <meta charset="utf-8"> 
  </head>
  <body>
    <div id="tweets0"></div>
    <div id="tweets1"></div>
    <div id="tweets2"></div>
    <div id="tweets3"></div>
    <div id="tweets4"></div>
    <div id="tweets5"></div>
    <div id="tweets6"></div>
    <div id="tweets7"></div>
    <div id="tweets8"></div>
    <script>

      var msgs = 0
      var queue = [];

      function update() {
        msgs += 1
        var msg = queue.shift();
        var delay = 250;
        if(msg != null) {
          document.getElementById("tweets" + (msgs % 9)).innerHTML = "<table><tr><td><img src='" + msg.message.user.profile_image_uri + "' /></td><td align='center'><table><tr><td><a target='_' href='http://twitter.com/" + msg.message.user.screen_name + "'>" + msg.message.user.screen_name + "</a></td></tr><tr><td>" + msg.message.text + "</td></tr></table></td></tr></table>";
          delay = 300;
          console.log(" pop:" + queue.length);
        }else {
          delay = 1000;
          console.log("none: " + queue.length);
        }
      }

      var stream = new EventSource('/tweet_stream');
      stream.addEventListener('message', function(event) {
        //if(queue.length > 10) queue.pop();
        queue.push(JSON.parse(event.data));
      }, false);
      

      stream.addEventListener('open', function(e) {
          console.log(e);
          // Connection was opened.
      }, false);

      stream.addEventListener('error', function(e) {
          console.log(e);
          if (e.readyState == EventSource.CLOSED) {
                // Connection was closed.
                  }
      }, false);
      update();
      window.setInterval(function() {update()}, 1000);
    </script>
  </body>
</html>
