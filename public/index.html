<html>
  <head>
  </head>
  <body>
    <div id="tweets" />
    <script>

var msgs = 0
      function update(msg) {
        msgs = msgs + 1;
        stop = true;
        document.getElementById("tweets").innerHTML = "<img src='" + msg.message.user.profile_image_uri + "' height=100px/> " + msg.message.text;
      }

      var stream = new EventSource('/tweet_stream');
      stream.addEventListener('message', function(event) {
        update(JSON.parse(event.data));
      }, false);
      

      stream.addEventListener('open', function(e) {
          console.log(e);
          // Connection was opened.
      }, false);

      stream.addEventListener('error', function(e) {
          console.log(e);
          if (e.readyState == EventSource.CLOSED) {
                // Connection was closed.
                  }
      }, false);
    </script>
  </body>
</html>
