#tweets
:javascript
  $('.refresh').show();
  var msgs = 0
  var rows = getParam("rows") || 9;
  var queue = [];
  var delay = getParam("delay") || 300;
  $('#tweets').append(function() {
    var ret = "";
    for(var i = 0; i<rows; i++) {
      ret += "<div class='tweet' id='tweets" + i + "'></div>"
    }
    return ret;
  });
  document.getElementById("delay_lbl").innerHTML= delay;
  document.getElementById("refresh_bar").max= 500;
  document.getElementById("refresh_bar").value= delay;

  function update() {
    msgs += 1
    var msg = queue.shift();
    if(msg != null) {
      if(delay >= 30) {
        document.getElementById("tweets" + (msgs % rows)).innerHTML = "<table><tr><td><img src='" + msg.message.user.profile_image_uri + "' /></td><td align='center'><table><tr><td><a target='_' href='http://twitter.com/" + msg.message.user.screen_name + "'>" + msg.message.user.screen_name + "</a></td></tr><tr><td>" + msg.message.text + "</td></tr></table></td></tr></table>";
      }else{
        //no profile image
        document.getElementById("tweets" + (msgs % rows)).innerHTML = "<table><tr><td><a target='_' href='http://twitter.com/" + msg.message.user.screen_name + "'>" + msg.message.user.screen_name + "</a></td></tr><tr><td>" + msg.message.text + "</td></tr></table>";
      }
    }else {
      console.log("none: " + queue.length);
    }
    window.setTimeout(function() {update()}, delay);
  }

  function refreshDelay(elem) {
    delay=elem.value;
    document.getElementById("delay_lbl").innerHTML= delay;
  }

  var stream = new EventSource('/tweet_stream');
  stream.addEventListener('message', function(event) {
    //if(queue.length > 10) queue.pop();
    queue.push(JSON.parse(event.data));
  }, false);
  

  stream.addEventListener('open', function(e) {
      console.log(e);
      // Connection was opened.
  }, false);

  stream.addEventListener('error', function(e) {
      console.log(e);
      if (e.readyState == EventSource.CLOSED) {
            // Connection was closed.
              }
  }, false);
  window.setTimeout(function() {update()}, delay);
  window.setInterval(function() { 
    document.getElementById("buffer_size").innerHTML = "msg backlog: " + queue.length;  
  }, 1000);

