#tweets
:javascript
  $('.refresh').show();
  var msgs = -1
  var queue = [];
  var rows = getParam("rows") || 10;
  var cols = getParam("cols") || 15;
  var delay = getParam("delay") || 60;
  var img_cnt = rows * cols;
  document.getElementById("delay_lbl").innerHTML= delay;
  document.getElementById("refresh_bar").max= 500;
  document.getElementById("refresh_bar").value = delay;

  $("#tweets").append(function() {
    var ret = "";
    for(var i = 0; i<rows; i++) {
      ret += "<div class='tweets" + i + " tweet'>";
      for(var j=0; j<cols; j++) {
        var cell = cols*i + j;
        ret += "<a href='' id='link" + cell + "' target='_'><img class='profile' id='img" + cell + "'></a>";
      }
    }
    return ret;
  });

  function updateBacklog() {
    document.getElementById("buffer_size").innerHTML = "msg backlog: " + queue.length;
  }

  function update() {
    msgs += 1
    var msg = queue.shift();
    if(msg != null) {
      document.getElementById("img" + (msgs % img_cnt)).src= msg.message.user.profile_image_uri; 
      document.getElementById("link" + (msgs % img_cnt)).href= "http://twitter.com/" + msg.message.user.screen_name; 
      document.getElementById("link" + (msgs % img_cnt)).title= msg.message.text + " (" + msg.message.user.screen_name + ")"; 
    }else {
      console.log("none: " + queue.length);
    }
    window.setTimeout(function() {update()}, delay);
  }

  function refreshDelay(elem) {
    delay=elem.value;
    document.getElementById("delay_lbl").innerHTML= delay;
  }

  var stream = new EventSource('/tweet_stream');
  stream.addEventListener('message', function(event) {
    //if(queue.length > 10) queue.pop();
    queue.push(JSON.parse(event.data));
  }, false);
  

  stream.addEventListener('open', function(e) {
      console.log(e);
      // Connection was opened.
  }, false);

  stream.addEventListener('error', function(e) {
      console.log(e);
      if (e.readyState == EventSource.CLOSED) {
            // Connection was closed.
              }
  }, false);
  window.setTimeout(function() {update()}, delay);
  window.setInterval(function() {updateBacklog()}, 1000);
